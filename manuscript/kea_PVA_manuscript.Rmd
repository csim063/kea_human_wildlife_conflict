---
title: |
  Additive influence of human-wildlife conflict and introduced mammalian predation on the population dynamics of Kea (*Nestor notabilis*)
author:
- name: E.M. Kennedy
  affiliation: Toi-Ohomai Institute of Technology
- name: G.L.W. Perry
  affiliation: University of Auckland
- name: C.E. Simpkins
  affiliation: University of G&ouml;ttingen, University of Auckland
abstract: "Human populations are continuing to expand into previously wild areas, bringing humans and wildlife into conflict. Human-wildlife conflicts often directly result in wildlife mortality events, termed human-induced mortality (HM). While HM is a well known phenomena, its overall impacts at the population-level has not been well studied. HM may interact with other sources of mortality, such as invasive predators, exacerbating both beyond the levels accounted for in conservation management plans. Our study aimed to explore the population-level impacts of changes in HM intensity, and how these impacts would interact with a major known source of mortality. To achieve these aims we developed a stage-based population model to simulate the population dynamics of kea (*Nestor notabilis*), an endangered parrot endemic to New Zealand. We used this model to run multiple scenarios with differing intensity levels of invasive mammalian predation and human-induced mortality. Mammalian predation had the most pronounced impact on kea populations. With unmanaged predation resulting in rapid extinction of the population. HM had a far smaller impact, with the current rate of HM not severely affecting kea population dynamics. However, when HM grew continually over time, simulating increased human populations, the kea population showed significant decreases in population size and extinction risk over time, and this was exacerbated by mammalian predation, even at currently managed levels. These results clearly show that while HM may not be an immediately pressing threat, if left unmanaged it can rapidly become a major issue to conservation management."
keywords: "conservation; extinction; human-induced mortality; population viability analysis; population dynamics"
geometry: margin=1in
fontfamily: mathpazo
fontsize: 11pt
bibliography: References/master.bib
biblio-style: apsr
output: 
  pdf_document:
    citation_package: natbib
    keep_tex: true
    fig_caption: true
    toc: false
    latex_engine: pdflatex
    template: manuscript_style_template.tex
---

```{r Data Analysis, message=FALSE, warning=FALSE, include=FALSE}
#-------------------------------------------------------------------------------------------------#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
# This script analyses the data output from the PVA model run using `Run_analysis.R`. The script
# also produces the visualisations used within the manuscript written for this PVA. The analysis
# is broken into two parts. First only the predation level effects are explored, using the no
# human-growth (i.e. no human induced mortality) runs. The second part of the script analyses the
# the effect of the different human growths, primarily on the baseline predation level runs to 
# see if there is any sort of tipping effect.

# Author: C.E. Simpkins

# Date: 25/04/2020
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#-------------------------------------------------------------------------------------------------#

#~~SETUP~~#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#-------------------------------------------------------------------------------------------------#

## Load all the required packages
library("progress") # get a standard progress bar
library("esvis") # calculate hedges_g
library("ggpubr") # help create well organised plots
library("Hmisc") # summary statistics
library("psych") # more summary statistics
library("tidyverse") # To help with data manipulation and plotting
library("wesanderson") # colours
library("plotrix") # improved plotting
library("data.table") # improved speed for rbind
library("foreach") # To create a for loop that can be parallelized
library("doParallel") # to run loops in parallel
library("snow") # To register the backend for the parallel loop

##~~Import data~~##
#-------------------------------------------------------------------------------------------------#
## Import all the data created in `Run_analysis.R` and perform some simple data cleaning to make
## the other analyses easier

## Scenario data
scen_df <- readRDS("../Output/Pred_simulations.RData")

## Sensitivity analysis data
SA_baseline <- readRDS("../Output/Sensitivity_Analysis/baseline.RData") %>% 
  mutate(parameter = "base")


SA_clutch_plus_25 <- readRDS("../Output/Sensitivity_Analysis/clutch_size_plus25.RData") %>% 
  mutate(parameter = "clutch_size_plus25")

SA_clutch_plus_10 <- readRDS("../Output/Sensitivity_Analysis/clutch_size_plus10.RData") %>% 
  mutate(parameter = "clutch_size_plus10")

SA_clutch_minus_10 <- readRDS("../Output/Sensitivity_Analysis/clutch_size_minus10.RData") %>% 
  mutate(parameter = "clutch_size_minus10")

SA_clutch_minus_25 <- readRDS("../Output/Sensitivity_Analysis/clutch_size_minus25.RData") %>% 
  mutate(parameter = "clutch_size_minus25")


SA_breeding_plus_25 <- readRDS("../Output/Sensitivity_Analysis/pop_breeding_plus25.RData") %>% 
  mutate(parameter = "breeding_plus25")

SA_breeding_plus_10 <- readRDS("../Output/Sensitivity_Analysis/pop_breeding_plus10.RData") %>% 
  mutate(parameter = "breeding_plus10")

SA_breeding_minus_10 <- readRDS("../Output/Sensitivity_Analysis/pop_breeding_minus10.RData") %>% 
  mutate(parameter = "breeding_minus10")

SA_breeding_minus_25 <- readRDS("../Output/Sensitivity_Analysis/pop_breeding_minus25.RData") %>% 
  mutate(parameter = "breeding_minus25")


SA_pop_plus_25 <- readRDS("../Output/Sensitivity_Analysis/pop_size_plus25.RData") %>% 
  mutate(parameter = "pop_plus25")

SA_pop_plus_10 <- readRDS("../Output/Sensitivity_Analysis/pop_size_plus10.RData") %>% 
  mutate(parameter = "pop_plus10")

SA_pop_minus_10 <- readRDS("../Output/Sensitivity_Analysis/pop_size_minus10.RData") %>% 
  mutate(parameter = "pop_minus10")

SA_pop_minus_25 <- readRDS("../Output/Sensitivity_Analysis/pop_size_minus25.RData") %>% 
  mutate(parameter = "pop_minus25")

## Bind all the sensitivity analyses into one data frame
SA_df <- dplyr::bind_rows(list(SA_baseline,
                               SA_clutch_plus_25, SA_clutch_plus_10, SA_clutch_minus_10, SA_clutch_minus_25,
                               SA_breeding_plus_25, SA_breeding_plus_10, SA_breeding_minus_10, SA_breeding_minus_25,
                               SA_pop_plus_25, SA_pop_plus_10, SA_pop_minus_10, SA_pop_minus_25))

## Clean up the global environment
rm(SA_baseline,
   SA_clutch_plus_25, SA_clutch_plus_10, SA_clutch_minus_10, SA_clutch_minus_25,
   SA_breeding_plus_25, SA_breeding_plus_10, SA_breeding_minus_10, SA_breeding_minus_25,
   SA_pop_plus_25, SA_pop_plus_10, SA_pop_minus_10, SA_pop_minus_25)

##~~Data cleaning~~##
#-------------------------------------------------------------------------------------------------#
## There are some idiosyncrasies in the raw data which may impact any analyses we perform on 
## them. So in this section we just clean these up

## There are a few places where the population or stage classes go below zero for a single step.
## This is a result of the non-negative catch only resetting once a negative has occurred. So
## while this wouldn't impact the results of the model it, may impact any summary statistics we
## produce and therefore we just convert any negative population to 0
scen_df[scen_df < 0] <- 0
SA_df[SA_df < 0] <- 0

## We chose to use numeric IDs to identify the different predation levels and growth types. These
## numerics may get a little confusing and annoying going forward so we change them into actual
## character descriptors here
scen_df$growth_type <- recode(scen_df$growth_type, 
                              `1` = "none", `2` = "static", `4` = "linear", `6` = "logistic")

scen_df$predation_level <- recode(scen_df$predation_level, 
                                  `1` = "low", `2` = "baseline", `3` = "high")

## As the first half of the analysis explores the impacts of predation alone, we create a new
## filtered data frame to use in that section of the script
pred_df <- scen_df %>% 
  filter(growth_type == "none", time >= 1)

## As the second half of the analysis explores the relative impact of HM to look for tipping
## points or similar, and since the high predation level shows such a dramatic rate of extinction
## even with no HM, we create data frame with high predation level removed. To keep the messaging
## of the paper focussed we decided to not examine logistic growth opting for a more simple story 
## of comparing no HM, a static HM, and one type of increasing HM (linear)
HIM_df <- scen_df %>% 
  filter(predation_level != "high", time >= 1, growth_type != "logistic")


#~~PREDATOR LEVEL ANALYSIS~~#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#-------------------------------------------------------------------------------------------------#
## This section of the script explores the impacts of predation level, when there is no human-
## induced mortality. 

##~~Time series of population~~##
#-------------------------------------------------------------------------------------------------#

## Create a data frame of summary statistics grouped by predation level and time-step (so 250 
## summary points per predation level) to use in the time-series
pred_ts_sum <- pred_df %>% 
  group_by(predation_level, as.integer(time)) %>% 
  summarise(mean_pop = mean(Population, na.rm = TRUE),
            std_pop = sd(Population, na.rm = TRUE),
            stderr_pop = std_pop/ sqrt(length(Population)),
            median_pop = median(Population, na.rm = TRUE),
            pop_75 = list(quantile(Population, 0.75))[[1]][[1]],
            pop_25 = list(quantile(Population, 0.25))[[1]][[1]],
            pop_05 = list(quantile(Population, 0.05))[[1]][[1]],
            pop_95 = list(quantile(Population, 0.95))[[1]][[1]],
            pop_33 = list(quantile(Population, 0.33))[[1]][[1]],
            pop_66 = list(quantile(Population, 0.66))[[1]][[1]]) %>% 
  rename(time = "as.integer(time)")

## Create a time series plots showing the change in median population at each time step for each
## predation level. A ribbon showing the area between the 25th and 75th percentiles is included to 
## indicate variance
palette <- c("#334FDA", "#c456e8", "#21A900")

pred_ts <- ggplot(pred_ts_sum, 
                  aes(y = median_pop, x = time, group = as.factor(predation_level))) +
  geom_ribbon(aes(ymin = pop_33, 
                  ymax = pop_66, 
                  alpha = as.factor(predation_level)), fill = "lightgray") +
  scale_alpha_manual(values = rep(1, 3)) +
  geom_line(aes(colour = as.factor(predation_level)), size = 1) +
  scale_color_manual(values = palette) +
  ylab("number of individuals") + 
  theme_classic() + theme(legend.position = "none")

pred_ts

##~~Calculate and visualise average population~~##
#-------------------------------------------------------------------------------------------------#

## Again we create a set of summary statistics to help with plotting. Here we first calculate a 
## weighted mean accounting for the fact that any run that went exticnt may be artificially 
## inflated due to a far reduced number of ticks in the model run. We then take the median of the
## weighted mean to get the summary statistics for each predation level.
pred_pop_sum <- pred_df %>% 
  group_by(Run, predation_level) %>% 
  summarise(weighted_mean_pop = sum(Population) / 250) %>% 
  group_by(predation_level) %>% 
  summarise(y0 = min(weighted_mean_pop),
            y25 = quantile(weighted_mean_pop, 0.01),
            y50 = quantile(weighted_mean_pop, 0.5),
            y75 = quantile(weighted_mean_pop, 0.99),
            y100 = max(weighted_mean_pop),
            average = mean(weighted_mean_pop),
            stDev = sd(weighted_mean_pop))

pred_pop_plot <- ggplot(pred_pop_sum, aes(x = as.factor(predation_level), group = predation_level)) +
  geom_boxplot(
    aes(ymin = y0, lower = y25, middle = y50, upper = y75, ymax = y100),
    stat = "identity") + 
  ylab("number of individuals") + xlab("scenario") +
  theme_classic()

pred_pop_plot

## Calculate the effect size differences in average population between the predation levels
temp <- pred_df %>% 
  group_by(Run, predation_level) %>% 
  summarise(weighted_mean_pop = sum(Population) / 250)

effect_pop_p <- esvis::hedg_g(weighted_mean_pop ~ predation_level, data = temp)
effect_pop_p$hedg_g <- abs(effect_pop_p$hedg_g)

rm(temp)

##~~Calculate the total number of quasi-extinctions~~##
#-------------------------------------------------------------------------------------------------#
## We defined an extinction as any point where the population dropped below 50 individuals and
## in this section of the code we calculate how many total extinctions occurred for firstly overall
## (i.e. all no human induced mortality runs), and then for each predation level. We also calculate
## the total number of full extinctions (i.e. pop = 0) to allow for a comparison

repeats <- length(unique(pred_df$Run))

extinct_pred_total <- pred_df %>%
  filter(time == 250) %>% 
  summarise(quasi_extinctions = repeats - sum(not_quasi_extinct),
            quasi_ex_percentage = (quasi_extinctions / repeats) * 100,
            extinctions = repeats - sum(not_extinct),
            ex_percentage = (extinctions / repeats) * 100)

#! Note that the amount of quasi-extinctions are identical to the amount of extinctions, likely
## indicating that if there is sufficiently bad conditions to cause a quasi-extinction in 250 years
## it will result in a full extinction given enough time.

# Now we examine how many extinctions occurred under each predation_level
levels <- 3 # there are three predation levels

extinct_pred <- pred_df %>% 
  filter(time == 250) %>% 
  group_by(predation_level) %>%
  summarise(extinctions = (repeats / levels) - sum(not_quasi_extinct),
            percentage = (extinctions / (repeats / levels)) * 100)

##~~Calculate the average time until quasi-extinctions~~##
#-------------------------------------------------------------------------------------------------#
## We defined an extinction as any point where the population dropped below 50 individuals and
## in this section of the code we calculate how long it took any run which went extinct to go
## extinct

time_extinct_pred <- pred_df %>% 
  group_by(Run, predation_level) %>%
  summarise(time_till_extinct = sum(not_quasi_extinct)) %>% 
  filter(time_till_extinct != 250) %>% 
  group_by(predation_level) %>% 
  summarise(av_time_extinct = mean(time_till_extinct), sd_time_extinct = sd(time_till_extinct))

##~~Calculate the average growth rate~~##
#-------------------------------------------------------------------------------------------------#

## Firstly, we calculate the growth rate at each time step for each run using a simple for loop
## This is done in parallel as it takes a little while otherwise.
registerDoParallel(detectCores() - 1)

r_pred <- as.data.frame(NULL)
r_pred <- foreach(i=1:length(unique(pred_df$Run)),
                  .packages = "data.table",
                  .combine = "rbind") %dopar% {
                    zero_t_pop <- 500 # Note starting number of individuals is hard coded here
                    temp <- pred_df[pred_df$Run == i,]
                    temp$R <- (temp$Population / zero_t_pop) ^ (1 / temp$time)
                    return(temp)
                  }

## Again we create a set of summary statistics to help with plotting. Here we first calculate a 
## weighted mean accounting for the fact that any run that went extinct may be artificially 
## inflated due to a far reduced number of ticks in the model run. We then take the median of the
## weighted mean to get the summary statistics for each predation level.
growth_pred_sum <- ungroup(r_pred) %>% 
  group_by(Run, predation_level) %>% 
  summarise(mean_growth = mean(R, na.rm = TRUE), 
            weighted_mean_growth = sum(R) / 250)%>% 
  group_by(predation_level) %>% 
  summarise(y0 = min(weighted_mean_growth),
            y25 = quantile(weighted_mean_growth, 0.01),
            y50 = quantile(weighted_mean_growth, 0.5),
            y75 = quantile(weighted_mean_growth, 0.99),
            y100 = max(weighted_mean_growth),
            mean_av = mean(weighted_mean_growth),
            stDev = sd(weighted_mean_growth))

## Calculate the effect size differences in growth rate between the predation levels
effect_growth_p <- esvis::hedg_g(R ~ predation_level, data = r_pred)
effect_growth_p$hedg_g <- abs(effect_growth_p$hedg_g)


#~~HUMAN-INDUCED MORTALITY ANALYSIS~~#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#-------------------------------------------------------------------------------------------------#
## This section of the script explores the impacts of human-induced mortailty and changes in its
## magnitude resulting from changes in the human population. We exclude the high predation level
## runs as these have been shown to already be highly impacted by mortality and obscure differences
## which may occur at the other levels.

##~~Time series of population~~##
#-------------------------------------------------------------------------------------------------#
## Create a data frame of summary statistics grouped by predation level, growth type, and time-step 
## (so 250 summary points per predation level and growth type) to use in the time-series
HIM_ts_sum <- HIM_df %>% 
  group_by(predation_level, growth_type, as.integer(time)) %>% 
  summarise(mean_pop = mean(Population, na.rm = TRUE),
            std_pop = sd(Population, na.rm = TRUE),
            stderr_pop = std_pop/ sqrt(length(Population)),
            median_pop = median(Population, na.rm = TRUE),
            pop_75 = list(quantile(Population, 0.75))[[1]][[1]],
            pop_25 = list(quantile(Population, 0.25))[[1]][[1]],
            pop_05 = list(quantile(Population, 0.05))[[1]][[1]],
            pop_95 = list(quantile(Population, 0.95))[[1]][[1]],
            pop_33 = list(quantile(Population, 0.33))[[1]][[1]],
            pop_66 = list(quantile(Population, 0.66))[[1]][[1]],
            pop_45 = list(quantile(Population, 0.45))[[1]][[1]],
            pop_55 = list(quantile(Population, 0.55))[[1]][[1]]) %>% 
  rename(time = "as.integer(time)")

## Create a time series plots showing the change in median population at each time step for each
## growth type. Two separate plots are made, one for low predation level and one for baseline
## predation, these are then presented in a two panel plot with equal axis. A ribbon showing the
## area between the 25th and 75th percentiles is included to indicate variance
## First low predation level
HIM_low_ts <- ggplot(HIM_ts_sum[HIM_ts_sum$predation_level == "low",], 
                     aes(y = median_pop, x = time, group = as.factor(growth_type))) +
  geom_ribbon(aes(ymin = pop_33, 
                  ymax = pop_66, 
                  alpha = as.factor(growth_type)), fill = "gray") +
  scale_alpha_manual(values = rep(0.4, 3)) +
  geom_line(aes(colour = as.factor(growth_type)), size = 0.8) +
  scale_colour_manual(values = c("#c456e8", "#21A900", "#334FDA")) +
  ylab("number of individuals") + ylim(0, 575) + # Note axis does not begin at 0
  theme_classic() + theme(legend.position = "none")

HIM_low_ts

## Second baseline predation level
HIM_base_ts <- ggplot(HIM_ts_sum[HIM_ts_sum$predation_level == "baseline",], 
                      aes(y = median_pop, x = time, group = as.factor(growth_type))) +
  geom_ribbon(aes(ymin = pop_33, 
                  ymax = pop_66, 
                  alpha = as.factor(growth_type)), fill = "gray") +
  scale_alpha_manual(values = rep(0.4, 3)) +
  geom_line(aes(colour = as.factor(growth_type)), size = 0.8) +
  scale_colour_manual(values = c("#c456e8", "#21A900", "#334FDA")) +
  ylab("number of individuals") + ylim(0, 575) + # Note axis does not begin at 0
  theme_classic() + theme(legend.position = "none")

HIM_base_ts

ggarrange(HIM_low_ts + rremove("legend"), 
          HIM_base_ts + rremove("ylab") + rremove("y.text") + rremove("legend"),
          labels = c("A", "B"),
          ncol = 2, nrow = 1, hjust = 62)


##~~Calculate and visualise average population~~##
#-------------------------------------------------------------------------------------------------#

## Again we create a set of summary statistics to help with plotting. Here we first calculate a 
## weighted mean accounting for the fact that any run that went exticnt may be artificially 
## inflated due to a far reduced number of ticks in the model run. 
HIM_pop_sum <- HIM_df %>% 
  group_by(Run, predation_level, growth_type) %>% 
  summarise(weighted_mean_pop = sum(Population) / 250)

HIM_pop_sum$growth_type <- factor(HIM_pop_sum$growth_type,
                                  levels = c("none", "static", "linear"))

HIM_pop_plot <- ggplot(HIM_pop_sum, 
                       aes(x = predation_level, y = weighted_mean_pop, colour = growth_type,
                           fill = growth_type)) +
  geom_violin(scale = "count", trim = FALSE) + 
  geom_boxplot(width = 0.5, position=position_dodge(0.9), aes(fill = "white"),
               outlier.size = 0.5) +
  scale_colour_manual(values = rep("black", 3)) +
  scale_fill_manual(values = c("#c456e8", "#21A900", "#334FDA", "white")) +
  ylim(0, 580) + ylab("mean number of individuals") + xlab("predation level") +
  theme_classic() + theme(legend.position = "none")

HIM_pop_plot

HIM_pop_summary <- HIM_pop_sum %>% 
  group_by(growth_type, predation_level) %>% 
  summarise(average = mean(weighted_mean_pop),
            stDev = sd(weighted_mean_pop))

## Calculate the effect size differences in average population between the predation levels
temp <- HIM_df %>% 
  group_by(Run, predation_level, growth_type) %>% 
  summarise(weighted_mean_pop = sum(Population) / 250)

effect_pop_HIM <- esvis::hedg_g(ungroup(temp), weighted_mean_pop ~ growth_type + predation_level)
effect_pop_HIM$hedg_g <- abs(effect_pop_HIM$hedg_g)

rm(temp)

##~~Calculate the total number of quasi-extinctions~~##
#-------------------------------------------------------------------------------------------------#
## We defined an extinction as any point where the population dropped below 50 individuals and
## in this section of the code we calculate how many total extinctions occurred for each growth 
## level.

repeats <- length(unique(HIM_df$Run))
levels <- 6 # there are three growth types and two predation_levels

extinct_HIM <- HIM_df %>% 
  filter(time == 250) %>% 
  group_by(predation_level, growth_type) %>%
  summarise(extinctions = (repeats / levels) - sum(not_quasi_extinct),
            percentage = (extinctions / (repeats / levels)) * 100)

##~~Calculate the average time until quasi-extinctions~~##
#-------------------------------------------------------------------------------------------------#
## We defined an extinction as any point where the population dropped below 50 individuals and
## in this section of the code we calculate how long it took any run which went extinct to go
## extinct

time_extinct_HIM <- HIM_df %>% 
  group_by(Run, predation_level, growth_type) %>%
  summarise(time_till_extinct = sum(not_quasi_extinct)) %>% 
  filter(time_till_extinct != 250) %>% 
  group_by(predation_level, growth_type) %>% 
  summarise(av_time_extinct = mean(time_till_extinct), sd_time_extinct = sd(time_till_extinct))

## Calculate the effect size differences in time until extinction between growth types for each of
## the predation levels
temp <- HIM_df %>% 
  group_by(Run, predation_level, growth_type) %>% 
  summarise(time_till_extinct = sum(not_quasi_extinct)) %>% 
  filter(time_till_extinct != 250)

effect_et_HIM <- esvis::hedg_g(ungroup(temp), time_till_extinct ~ growth_type + predation_level)
effect_et_HIM$hedg_g <- abs(effect_et_HIM$hedg_g)

rm(temp)

##~~Calculate the average growth rate~~##
#-------------------------------------------------------------------------------------------------#

## Firstly, we calculate the growth rate at each time step for each run using a simple for loop
## This is done in parallel as it takes a little while otherwise. Same as for predation level
registerDoParallel(detectCores() - 1)

r_HIM <- as.data.frame(NULL)
r_HIM <- foreach(i=1:length(unique(HIM_df$Run)),
                 .packages = "data.table",
                 .combine = "rbind") %dopar% {
                   zero_t_pop <- 500 # Note starting number of individuals is hard coded here
                   temp <- HIM_df[HIM_df$Run == i,]
                   temp$R <- (temp$Population / zero_t_pop) ^ (1 / temp$time)
                   return(temp)
                 }

## Again we create a set of summary statistics to help with plotting. Here we first calculate a 
## weighted mean accounting for the fact that any run that went extinct may be artificially 
## inflated due to a far reduced number of ticks in the model run. We then take the median of the
## weighted mean to get the summary statistics for each predation level.
growth_HIM_sum <- ungroup(r_HIM) %>% 
  group_by(Run, predation_level, growth_type) %>% 
  summarise(mean_growth = mean(R, na.rm = TRUE), 
            weighted_mean_growth = sum(R) / 250)%>% 
  group_by(predation_level, growth_type) %>% 
  summarise(y0 = min(weighted_mean_growth),
            y25 = quantile(weighted_mean_growth, 0.01),
            y50 = quantile(weighted_mean_growth, 0.5),
            y75 = quantile(weighted_mean_growth, 0.99),
            y100 = max(weighted_mean_growth),
            mean_av = mean(weighted_mean_growth))

## Calculate the effect size differences in growth rate between the predation levels
effect_growth_HIM <- esvis::hedg_g(R ~ predation_level + growth_type, data = ungroup(r_HIM))
effect_growth_HIM$hedg_g <- abs(effect_growth_HIM$hedg_g)

## Make a visualisation
HIM_growth <- ungroup(r_HIM) %>% 
  group_by(Run, predation_level, growth_type) %>% 
  summarise(weighted_mean_growth = sum(R) / 250)

HIM_growth$growth_type <- factor(HIM_growth$growth_type,
                                 levels = c("none", "static", "linear"))

HIM_growth_plot <- ggplot(HIM_growth, 
                          aes(x = predation_level, y = weighted_mean_growth, colour = growth_type,
                              fill = growth_type)) +
  geom_violin(scale = "count", trim = FALSE) + 
  geom_boxplot(width = 0.5, position=position_dodge(0.9), aes(fill = "white"),
               outlier.size = 0.5) +
  scale_colour_manual(values = rep("black", 3)) +
  scale_fill_manual(values = c("#c456e8", "#21A900", "#334FDA", "white")) +
  ylim(0.98, 1.005) + ylab("mean growth rate") + xlab("predation level") +
  theme_classic() + theme(legend.position = "none") + 
  geom_hline(yintercept = 1, linetype = "dashed")

HIM_growth_plot

#~~SENSITIVITY ANALYSIS~~#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#-------------------------------------------------------------------------------------------------#
# Based off of population
# Get sensitivity values
SA_sum <- SA_df %>% 
  group_by(parameter) %>% 
  summarise(av_pop = mean(Population, na.rm = TRUE),
            var_pop = sd(Population, na.rm = TRUE))

sensitivity <- function(base_in, base_out, percent_change, new_out){
  new_in <- base_in * percent_change
  
  delta_in <- new_in - base_in
  delta_out <- new_out - base_out
  
  s <- abs((delta_out / base_out) / (delta_in / base_in))
  
  return(s)
}

clutch_plus25 <- sensitivity(1.5, SA_sum$av_pop[1], 1.25, SA_sum$av_pop[9])
clutch_plus10 <- sensitivity(1.5, SA_sum$av_pop[1], 1.1, SA_sum$av_pop[8])
clutch_minus10 <- sensitivity(1.5, SA_sum$av_pop[1], 0.9, SA_sum$av_pop[6])
clutch_minus25 <- sensitivity(1.5, SA_sum$av_pop[1], 0.75, SA_sum$av_pop[7])

breeding_plus25 <- sensitivity(0.6, SA_sum$av_pop[1], 1.25, SA_sum$av_pop[5])
breeding_plus10 <- sensitivity(0.6, SA_sum$av_pop[1], 1.1, SA_sum$av_pop[4])
breeding_minus10 <- sensitivity(0.6, SA_sum$av_pop[1], 0.9, SA_sum$av_pop[2])
breeding_minus25 <- sensitivity(0.6, SA_sum$av_pop[1], 0.75, SA_sum$av_pop[3])

pop_plus25 <- sensitivity(500, SA_sum$av_pop[1], 1.25, SA_sum$av_pop[13])
pop_plus10 <- sensitivity(500, SA_sum$av_pop[1], 1.1, SA_sum$av_pop[12])
pop_minus10 <- sensitivity(500, SA_sum$av_pop[1], 0.9, SA_sum$av_pop[10])
pop_minus25 <- sensitivity(500, SA_sum$av_pop[1], 0.75, SA_sum$av_pop[11])

# Effect size difference (avoid p-values as can just simulate to significance)
# Rule of thumb <=0.2 small >= 0.8 large rest medium
hedges_g_SA <- esvis::hedg_g(Population ~ parameter, data = SA_df)
hedges_g_SA$hedg_g <- abs(hedges_g_SA$hedg_g)

##~~Time until extinction for sensitivity parameters~~##
#-------------------------------------------------------------------------------------------------#
## We defined an extinction as any point where the population dropped below 50 individuals and
## in this section of the code we calculate how long it took any run which went extinct to go
## extinct

SA_extinct <- SA_df %>% 
  group_by(Run, parameter) %>%
  summarise(time_till_extinct = sum(not_quasi_extinct)) %>% 
  filter(time_till_extinct != 250) %>% 
  group_by(parameter) %>% 
  summarise(av_time_extinct = mean(time_till_extinct), sd_time_extinct = sd(time_till_extinct))

## Calculate the effect size differences in time until extinction between growth types for each of
## the predation levels
temp <- SA_df %>% 
  group_by(Run, parameter) %>% 
  summarise(time_till_extinct = sum(not_quasi_extinct)) %>% 
  filter(time_till_extinct != 250)

effect_et_SA <- esvis::hedg_g(ungroup(temp), time_till_extinct ~ parameter)
effect_et_SA$hedg_g <- abs(effect_et_SA$hedg_g)

rm(temp)

#~~EXPLORING HIGH PREDATION FURTHER~~#
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~#
#-------------------------------------------------------------------------------------------------#

HP_baseline <- readRDS("../Output/Sensitivity_Analysis/High_pred_pop_base.RData") %>% 
  mutate(parameter = "base")

HP_ten <- readRDS("../Output/Sensitivity_Analysis/High_pred_pop_plus10.RData") %>% 
  mutate(parameter = "ten")

HP_twenty <- readRDS("../Output/Sensitivity_Analysis/High_pred_pop_plus25.RData") %>% 
  mutate(parameter = "twenty")

## Bind all the sensitivity analyses into one data frame
HP_df <- dplyr::bind_rows(list(HP_baseline, HP_ten, HP_twenty))

## Clean up the global environment
rm(HP_baseline, HP_ten, HP_twenty)


##~~Calculate the total number of quasi-extinctions for high predation scenarios~~##
#-------------------------------------------------------------------------------------------------#
## We defined an extinction as any point where the population dropped below 50 individuals and
## in this section of the code we calculate how many total extinctions occurred for each growth 
## level.

repeats <- length(unique(HP_df$Run))
#levels <- 3 # there are three growth types and two predation_levels

count_extinct_HP <- HP_df %>% 
  filter(time == 250) %>% 
  group_by(parameter) %>%
  summarise(extinctions = repeats - sum(not_quasi_extinct),
            percentage = extinctions / repeats * 100)

##~~Time until extinction for high predation scenarios~~##
#-------------------------------------------------------------------------------------------------#
## We defined an extinction as any point where the population dropped below 50 individuals and
## in this section of the code we calculate how long it took any run which went extinct to go
## extinct

HP_extinct_time <- HP_df %>% 
  group_by(Run, parameter) %>%
  summarise(time_till_extinct = sum(not_quasi_extinct)) %>% 
  filter(time_till_extinct != 250) %>% 
  group_by(parameter) %>% 
  summarise(av_time_extinct = mean(time_till_extinct), sd_time_extinct = sd(time_till_extinct))
```

# Introduction

Humans are rapidly expanding into wildlife areas [@Watson2016], causing an increase in the number of animal deaths directly attributable to humans, termed human-induced mortality (HM). Direct human-wildlife conflict (HWC) is widely reported because it affects both humans and wildlife populations (e.g., wildlife attacks on humans, crop raiding, and property destruction; @Woodroffe2005). A number of conflict-prone species are threatened or endangered (e.g., African elephants (*Loxodonta africana*) and griffon vultures (*Gyps fulvus*)), and it is assumed that HM plays a role in such population declines [@thouless1994; @landa1999; @margalida2014]. Unfortunately, species often face a myriad of threats. Furthermore, these threats can interact making it difficult to quantify the effect of each one individually. Additionally, increases in small but unmanaged mortality sources (including HM), may in combination with other mortality sources, tip the population below sustainable levels. Therefore, it is important that managers ascertain the magnitude of the impact of HM on a specific population. Managers often have limited resources (e.g. money, time, and equipment) and need detailed information about whether it might be more practical to try to mitigate all threats, or, alternatively, to focus intensively on a smaller suite of particular threats/limiting factors. Despite the need to measure the impacts of HM, studies explicitly quantifying the mortality directly resultant from human wildlife interaction events are rare. This shortfall may be due to many conflict scenarios being relatively new (and constantly changing), so demographic data capturing the effects of human-wildlife conflict are scarce.     

Kea (*Nestor notabilis*) are one of New Zealand’s notable examples of a species that suffers from HWC.  They are the world’s only mountain- and rainforest-dwelling parrot [@greer2015], and have an innate intelligence and curiosity that stems from the need to source a wide variety of food [@diamond1999; @auersperg2011]. Historically, this curiosity has led to conflict after farmers reported incidences of kea attacking sheep to eat fat from around their kidneys, occasionally leading to the death of the sheep from sepsis [@orrWalker2009]. Consequently a bounty on kea was instituted by the government, leading to c. 150,000 individuals being killed over a 100-year period [@temple1996], before the species was afforded full protection under the Wildlife Act in 1986. Kea are still known to damage human property, and there are continued reports of kea strike on sheep, resulting in direct persecution and indirect human-induced mortality (Reid, pers. comm.). Kea populations have also been decimated by introduced mammalian species,  with kea now largely only able to breed within areas under active predator management [@kemp2018]. Even attempts to protect kea have created unexpected HM; 1080 (sodium fluoroactetate), which has been used as a poisoning agent to control introduced mammalian predators, can cause the accidental death of adult kea through ingestion of the bait [@orr2012], although the positive benefits to kea reproductive rate due to predator management outweigh the direct mortality caused by 1080 [@kemp2018]. Due to these on going human threats [@gartrell2007], as well as, pressure from mammalian predators [@kemp2018], kea populations continue to be at risk [@elliott2004]. Recently, kea were classified as ‘Nationally Endangered’ by the New Zealand Department of Conservation and the IUCN classification is ‘Endangered’ [@IUCN2020]. Despite the kea’s conservation status, little is known about the influence of HM on kea population dynamics, or how the growth of the tourist population in kea habitat areas will alter these dynamics.      

Population viability analysis (PVA) is an effective means of quantifying population dynamics, and can provide essential information for management of threatened and endangered species [@boyce1992; @morris2002]. PVAs are quantitative models informed by demographic data, that allow researchers to evaluate and predict how  biotic and abiotic factors will affect population growth or decline over time [@beissinger1998; @Mills2002]. Historically, PVAs have been used primarily as predictive tools, e.g. to calculate minimum viable populations and to predict absolute values of future populations [@boyce1992; @ginzburg1982]. However, as models are simplifications of the systems and phenomena they represent there is always uncertainty associated with their predictions [@coulson2001; @ellner2002]. More recently, it has been recommended that PVAs are best used to explore the qualitative differences between counter factual scenarios, rather than making absolute quantitative predictions [@simpkins2018]; this more qualitative approach has been shown to be effective in understanding the relative importance of different factors driving population dynamics [e.g. @simpkins2015]. A few studies have used the PVA framework to explore the relative impact of HM on conflict-prone species [e.g @lafever2008; @goswami2014]; however, the number of such studies remains small. 

Our goal  was to explore how changes in the magnitude of HM, in kea habitats, will interact with introduced predator management to impact kea population dynamics, and thus determine what, if any, shifts in management are needed to ensure the long-term survival of the species. To achieve this goal we developed an age-structured, density-dependent model of kea, which we used to evaluate how alternative predator management scenarios impact the long term viability of kea with and without additional HM.

# Materials and Methods
## Study Species

Kea (*Nestor notablis*) are large, omnivorous parrots restricted to the South Island of New Zealand (Figure 1). Kea inhabit environments from coastal dunes to alpine peaks but are most common in high-elevation southern beech (Nothofagaceae) forest, sub-alpine shrublands, and high-alpine basins and ridges [@higgins1999; @robertson2007]. The current kea population size is uncertain, but recent estimates are between 1000-5000 wild birds [@anderson1986; @pullar1996], with an upper population range of 15000 individuals [@bond1992].  It is difficult to precisely estimate kea numbers due to their extensive range (largely in rugged terrain), low density, and the cryptic behaviour of adults [@orrWalker2009].     

The maximum life span of kea in the wild is thought to be c. 25 years, but birds in captivity have lived for more than 47 years [@brouwer2000]. Kea are non-territorial, and form monogamous long-term pairs [@bond1991]. They nest on the ground in crevices, usually below the treeline [@mccaskill1954]. Females generally become sexually mature between 3 and 4 years of age [@jackson1963]. Individuals nest between July and January, producing a single clutch of between 1 and 5 eggs. Incubation takes 22-24 days, and chicks fledge in approximately 90 days. Kea chicks have a long juvenile period and are dependent on their parents for 4-5 months after hatching [@orrWalker2010].


```{r Create Figure 1, fig.cap="test", message=FALSE, warning=FALSE, include=FALSE}
# Block creates a simple map of the locations where Kea are naturally located
library("tmap")
library("ggmap")
library("spData")
library("sf")

# Import the recorded Kea sitings (taken from GBIF)
# Filter to remove inaccurate points and only use recent data
sites <- read_delim("../External_data/Kea_sitings.csv", 
                    "\t", escape_double = FALSE, trim_ws = TRUE) %>% 
  filter(countryCode == "NZ" &
           stateProvince != "Waikato" &
           gbifID != 594284633 & gbifID != 594176880 & #remove clearly erroneous points
           year >= 1995)

# Select only the relavant columns and complete observations
sites <- sites %>% 
  select(gbifID, species, decimalLongitude, decimalLatitude, year)

sites <- na.omit(sites)
sites$year <- as.factor(sites$year)

# Convert to a spatial object
sites <- st_as_sf(sites, 
                  coords = c("decimalLongitude", "decimalLatitude"),
                  crs = 4326)

# Create the plot ##Warmer colors are more recent
Fig_1 <- tm_shape(nz) +
  tm_fill() +
  tm_shape(sites) +
  tm_symbols(size = 0.1, col = "year", shape = 19, alpha = 0.5, 
             legend.col.show = FALSE, palette = wes_palette("Zissou1", 25, type = "continuous")) +
  tm_compass(position = c("left", "top"), size = 2.5) +
  tm_scale_bar(breaks = c(0, 100, 200), text.size = 0.8)
```

```{r Kea_map, echo=FALSE, fig.cap="Kea sightings recorded since 1995 in the South Island of New Zealand (data taken from @Gbif2020). Warmer colours indicate more recent sightings", message=FALSE, warning=FALSE}

Fig_1

```

## Model Structure

We implemented a stochastic simulation model incorporating three stage classes to explore the effects of interactions between predation and HM on kea population dynamics. The three stage classes were juveniles (0-1 year), sub-adults (1-3 years), and adults (3+ years). These stage classes were selected to match significant changes in behaviour, mortality risk, and breeding ability in the life history of the species. The model represented the transition between each stage class, breeding, and mortality (Figure 2). Mortality rates aggregated background, predation mortality, and HM, with the level of predation and human-induced mortality varied depending on the scenario being explored.      

Only females were represented in the model as the kea's monogamous reproductive status indicates that unpaired males rarely contribute to population growth [@bond1991; @ferson1995]. Furthermore, previous research suggests there is a male sex-bias in wild populations, meaning that females are more likely to form pair-bonds than males [@bond1991; @bond1992]. The demographic parameters in the model varied stochastically through time but were perfectly correlated; although this correlation in vital rates is unlikely, it is a more conservative approach to assessing the population's viability than treating each rate as independent [@ellner2002; @ferson1995]. As the model represents national mean population abundances and demographic rates, and kea are endemic to New Zealand, we assumed a closed population.

The model was constructed in R v3.6.2 [@R2020], using the deSolve package v1.27.1 [@soetaert2010]. The model ran for 250 timesteps (each timestep representing one year). This period was chosen as it was sufficient to detect demographic trends in long-lived species.

![Overview of the kea population model. Rectangular boxes denote the population stocks for each stage class, note to denote that kea remain as sub-adults for two timesteps in the model there are two sub-adult stocks. The double-lined arrows represent the flow of individuals. The single-lined arrows represent connections between model parameters. The grey diamonds denote variable rate factors, in this case mortality rates.](Figures/Kea_model.png)

## Model parameters
### Population parameters

Initial population size of 500 female kea was based on the lowest published estimate [@pullar1996]. We used the lowest value because there is considerable uncertainty in population estimates [@orrWalker2009], and we wanted to present a conservative rather than optimistic estimate of extinction risk. To ensure that this choice did not overly alter the results of the model the initial population size was included as a parameter in the sensitivity analysis (see Model execution and analysis section). We assumed an equal division of individuals (i.e. 125 individuals within each stock) for the initial timestep.

### Reproduction

Kea have a mostly monogamous breeding system [@bond1991], and begin breeding from three years of age [@jackson1963]. To simulate this behaviour only adult birds (over three years of age) bred in our model. Fecundity was defined as the product of the number of adult females, clutch size, and egg survival. The proportion of breeding adults was set at 0.6 as not all females breed successfully every year [@bond1991]. Clutch size for kea was generated using a bounded Poisson distribution with a rate ($\lambda$) of 1.5 and with minimum and maximum values of one and eight respectively. This value was selected to generate clutch sizes similar to those observed in kea, between 1-5, taking into account that only approximately half the chicks would be female [@bond1992].

### Mortality

Mortality rates varied across the three stage classes. Mortality rates were composed of predation, HM, and background mortality. Predation and background mortality rates were based on the data collected by @seal1991 (Table 1). In addition, approximately every four years a beech mast occurs [@ogden1996], triggering irruptions of mammalian predators that predate kea, leading to an increase in predation mortality [2001@elliott1996; @choquenot2006]. This masting dynamic was accounted for by adding a mast event with a 0.25 probability of occurring each time step. No temporal structure in the pattern of masting was assumed, meaning that masts could occur in successive years. To simulate the impact of a mammalian predator population spike resulting from a mast the predation rate for all stage classes increased by 0.1 during a mast time step. Stochasticity was added to the baseline mortality rates by multiplying them by values drawn from a random uniform distribution with values 10% above and below the baseline rate.  

| Stage class | \emph{N} | Current/baseline mortality| Low predation | High predation |
|----------:|:-:|:---------------------------:|:---------------------------:|:---------------------------:|
| Egg       | - | 0.4                         | 0.2              | 0.8                |
| Juvenile  | 125 | 0.2                       | 0.1            | 0.4                |
| Sub-adult | 250 | 0.05                     | 0.025            | 0.2                |
| Adult     | 125 | 0.1                      | 0.05            | 0.3                |
Table: Initial number of individuals in each stage class and predation rates used in the PVA model. \emph{N} is the initial number of individuals. Rates are all expressed as probability per timestep/year.

Department of Conservation's database was used to determine how many kea deaths could be attributed to HM. We considered intentional causes (e.g. shooting, trapping) and accidental causes (e.g. vehicle strike) as HM. We assumed HM rates were the same across all stage-classes, although no HM was assigned to eggs, as kea nests are cryptic and there is minimal chance of people interacting with them. To represent potential changes in HM due to human population change over time we evaluated three potential population scenarios: 1) No HM (baseline); 2) HM at a constant rate of 0.015 (matching the currently observed HM rate); and 3) a linear increase in HM. The linear rate of increase was set as 0.0003 per time step (i.e. an increment of 2% of the currently observed HM rate per time step). This rate was selected to match the approximate 2% national human population population growth rate, assuming a one to one relationship between population size and HM.

Linear growth was calculated as:
\begin{equation}
  M_{t+1} = M_{t} + C
\end{equation}

Where $M$ is mortality and $C$ is the rate of change in the population. 

## Model execution and analysis

Each scenario was evaluated by running 1000 simulations of 250 timesteps each (unless the population reached zero before this time). We used a critical population size as a 'quasi-extinction' threshold [@morris2002], as this is often used to set conservation policy [@mace1991]. We defined the quasi-extinction threshold as a population of 50 individuals [@holmes2007; @otway2004]. Time until extinction was determined by calculating the first year in which the quasi-extinction threshold was passed. The overall extinction risk was estimated as the proportion of replicates for each scenario which experienced a quasi-extinction (i.e. $N < 50$).

Mean population growth rates for each scenario were determined using the mean geometric growth:
\begin{equation}
  \lambda_g = (\frac{N_t}{N_0})^{\frac{1}{t}}
\end{equation}

Where $\lambda_g$ is the growth rate; $N_t$ is the number of kea at time $t$; and $N_0$ is the number of kea at time zero. To check whether any observed differences between scenarios were statistically notable we used the Cohen D effect size metric, which measures the size of an experimental effect (see @nakagawa2007 for additional details on effect size statistics).

We also conducted a local univariate sensitivity analysis for initial population size, clutch size and the proportion of breeding adults, which were determined to be demographic values with a high level of uncertainty. The sensitivity analysis was run using current/baseline predation rates and no HM. Each parameter was individually varied by $\pm 10 \%$ and $\pm 25 \%$ of their baseline value and the model run for 250 timesteps for 1000 repeats with each value. As the clutch size was drawn from a Poisson distribution the $\lambda$ of this distribution was altered. The parameter sensitivities were determined using the index described by @hamby1994.
\begin{equation}
  S_{y,x} = \frac{(\frac{\Delta y}{y_b})}{(\frac{\Delta x}{x_b})}
\end{equation}

Where $S_{y,x}$ is the sensitivity of the output variable $y$ to a change in the input variable $x$. $\Delta y$ is the change in output variable $y$, $y_b$ is the baseline output. $\Delta x$ is the change in input variable $x$, $x_b$ is the baseline input. The final population size aggregated across all stage classes was used as the output variable of interest and a parameter was considered to be ‘sensitive’ if the index resulted in a value > 1.

# Results
## Predation management

Of the 3000 runs with no additional HM, `r extinct_pred_total$quasi_extinctions` (`r extinct_pred_total$quasi_ex_percentage`%) resulted in extinction events (i.e. population dropping below 50 individuals). The high predation scenario showed a 100% extinction rate (i.e. `r extinct_pred$extinctions[2]` extinction events) with a mean time until extinction of `r round(time_extinct_pred$av_time_extinct[2])` $\pm$ `r round(time_extinct_pred$sd_time_extinct[2], 1)` years (mean $\pm$ 1 SD). To explore whether the high rate of extinction seen in the high predation scenario was influenced by population size we run the model again with an initial population $10 \%$ and $25 \%$ higher. Each initial population setting was run for a maximum of 250 timesteps for 1000 repeats. An increase to the initial population size did not have any notable effect on the high predation scenario results, with both initial population abundances experiencing a 100% extinction rate and a time until extinction of less than 10 years.Under the baseline predation scenario 11 of the 1000 simulations ended in extinction, with a mean time until extinction of `r round(time_extinct_pred$av_time_extinct[1])` $\pm$ `r round(time_extinct_pred$sd_time_extinct[1], 1)` years. Interestingly, the low predation scenario runs resulted in `r extinct_pred$extinctions[3]` extinctions, slightly higher than the baseline scenario, although this small difference is likely due to the stochastic nature of the model, and as stated below abundances tended to be higher in the low predation scenario.

All three predation scenarios showed an initial burn-in in population, representing initial transient dynamics, followed by a continuing period of relatively unchanging population numbers (Figure 3). The high predation scenario clearly had a higher mortality rate than replacement rate, resulting in rapid extinction. Under baseline/current predation levels there was an initial decrease in the number of individuals, quickly reaching a stable level of approximately 350 females. Under low predation levels, the rate of replacement outstripped mortality initially, resulting in a period of population growth followed by a stable period with a population of approximately 500 individuals. These trends were mirrored in the mean population sizes of each predation scenario with high predation having the lowest population (`r round(pred_pop_sum$average[2])` $\pm$ `r round(pred_pop_sum$stDev[2], 1)`), being a lot lower (Cohen D = `r round(effect_pop_p$coh_d[1], 1)`) than the baseline/current predation scenario (`r round(pred_pop_sum$average[1])` $\pm$ `r round(pred_pop_sum$stDev[1])`), which was considerably lower (Cohen D = `r round(effect_pop_p$coh_d[5], 1)`) than the low predation scenario (`r round(pred_pop_sum$average[3])` $\pm$ `r round(pred_pop_sum$stDev[3])`).

The mean growth rates for the three predation scenarios showed the same trend as discussed above. The high predation scenario showed the lowest growth rate (`r round(growth_pred_sum$mean_av[2], 3)` $\pm$ `r round(growth_pred_sum$stDev[2], 3)`), which was far lower (Cohen D = `r round(effect_growth_p$coh_d[1], 1)`) than that under the baseline/current predation scenario (`r round(growth_pred_sum$mean_av[1], 3)` $\pm$ `r round(growth_pred_sum$stDev[1], 3)`). There was only a notable difference (Cohen D = `r round(effect_growth_p$coh_d[5], 1)`) between the baseline/current predation scenario growth rate, and the low predation scenario growth rate (`r round(growth_pred_sum$mean_av[3], 3)` $\pm$ `r round(growth_pred_sum$stDev[3], 3)`), though this was likely reduced by the long period of stable population for each scenario.

```{r Population timeseries figure, echo=FALSE, fig.cap="Change in the median number of individuals through time for each of the predation scenarios. The green line is the low predation scenario; blue line is the baseline/current predation scenario; and the violet line is the high predation scenario. The gray bands represent the 33^rd^ to 66^th^ quantile band", message=FALSE, warning=FALSE}
pred_ts
```

## Human-induced mortality
Due to the large difference in values for the high predation scenario compared to the baseline/current and low predation scenarios it was removed from the analysis of HM to avoid any trends being obscured.

There were only minor differences in the overall extinction rate across the three HM scenarios for either baseline/current or low predation (Table 2). Notably, the no additional HM scenarios had the highest rates of extinction (1.1% of baseline/current predation runs and 1.8% of low predation runs), likely due to the stochastic nature of the model. Again, there were only small differences in the mean time until extinction of each scenario, although the rankings for the different HM scenarios differed from that of predation rate.

| Predation level | Human-induced mortality scenario| Percentage of runs ending in extinction | Mean time-steps until extinction ($\pm$ standard deviation) | Mean population size ($\pm$ standard deviation) |
|---------:|:---------:|:---------:|:---------:|:---------:|
| Baseline | None      | 1.1       | 106 $\pm$ 73| 335 $\pm$ 24|
| Baseline | Static    | 0.8       | 146 $\pm$ 92| 297 $\pm$ 20|
| Baseline | Linear    | 0.4       | 219 $\pm$ 61| 211 $\pm$ 9|
| Low      | None      | 1.8       | 119 $\pm$ 75| 527 $\pm$ 45|
| Low      | Static    | 0.7       | 160 $\pm$ 52| 487 $\pm$ 19|
| Low      | Linear    | 1.4       | 128 $\pm$ 74| 393 $\pm$ 27|
Table: Percentage of total runs ending in quasi-extinction (i.e. fewer than 50 individuals), mean time for an extinction event to occur, and the mean number of females for each human-induced mortality scenario under baseline/current and low predation levels.

The general impact of the different HM scenarios on the number of individuals in the population was the same for baseline/current and low predation levels (Figure 4). Linearly increasing HM resulted in far lower (Cohen D > 3.0) population sizes for both baseline/current (`r round(HIM_pop_summary$average[5])` $\pm$ `r round(HIM_pop_summary$stDev[5])`) and low (`r round(HIM_pop_summary$average[6])` $\pm$ `r round(HIM_pop_summary$stDev[6])`) predation levels than either static or no HM scenarios. Linearly increasing HM also produced a declining population trend, resulting in larger differences with the other scenarios as model runs progressed (Figure 4). Static and no HM scenarios produced similar outcomes, though static HM had consistently lower population sizes for both baseline/current (`r round(HIM_pop_summary$average[3])` $\pm$ `r round(HIM_pop_summary$stDev[3])` compared to `r round(HIM_pop_summary$average[1])` $\pm$ `r round(HIM_pop_summary$stDev[1])` for no HM) and low (`r round(HIM_pop_summary$average[4])` $\pm$ `r round(HIM_pop_summary$stDev[4])` compared to `r round(HIM_pop_summary$average[2])` $\pm$ `r round(HIM_pop_summary$stDev[2])` for no HM) predation levels, with these differences having a large effect size (Cohen D = `r round(effect_pop_HIM$coh_d[14])` and Cohen D = `r round(effect_pop_HIM$coh_d[20])` for baseline and low predation level scenarios, respectively). The trend in mean population size is reflected in the mean growth rate produced by each scenario (Figure 6.).

```{r Population timeseries for HIM figure, echo=FALSE, fig.cap="Change in the median number of individuals (pooled across all stage classes) through time for each of the HM scenarios under low (A) and baseline/current (B) predation levels. The blue lines are the static HM scenarios; violet lines are the linearly increasing HM scenarios; and the green lines are the no HM scenarios. The gray bands represent the 33^rd^ to 66^th^ quantile band", message=FALSE, warning=FALSE}
ggarrange(HIM_low_ts + rremove("legend"), 
          HIM_base_ts + rremove("ylab") + rremove("y.text") + rremove("legend"),
          labels = c("A", "B"),
          ncol = 2, nrow = 1, hjust = -20)
```

```{r Average population for HIM violin plot, echo=FALSE, fig.cap="The mean number of individuals (pooled across all stage classes) after 250 years for each of the 1000 simulations of each of the HM scenarios under low and baseline/current predation levels. The green distributions are the no HM scenario; the center blue distributions are the static HM scenario; and the violet distributions are the linearly increasing HM scenario.", message=FALSE, warning=FALSE}
HIM_pop_plot
```

```{r Average growth rate for HIM violin plot, echo=FALSE, fig.cap="The mean growth rate for each of the 1000 runs for each of the HM scenarios under low and baseline/current predation levels. The green distributions are the no HM scenario; the blue distributions are the static HM scenario; and the violet distributions are the linearly increasing HM scenario.", message=FALSE, warning=FALSE}
HIM_growth_plot
```

## Sensitivity Analysis

The model was not sensitive to any of the three parameters tested (initial population size, clutch size, or proportion of breeding females) at either the $\pm 10 \%$ or $\pm 25 \%$ (Table 3). This suggests that the model outcomes were robust to uncertainty in estimating these parameters.

| Parameter     | Plus 25% | Plus 10% | Minus 10% | Minus 25% |
|--------------:|:---------:|:---------:|:---------:|:---------:|
| Initial population  | 0.08      | 0.01       | 0.23       |0.04        |
| Clutch size         | 0.28      | 0.15       | 0.12       | 0.16       |
| Proportion breeding | 0.18      | 0.17       | 0.28       | 0.29       |
Table: Sensitivity values calculated for each of the three tested parameters at each of the four percentage change values. Higher values indicate that the model is more sensitive to those changes, with values greater than one suggesting the model is disproportionately sensitive to that change.

# Discussion

Our model outcomes clearly demonstrate that changes in either the level of mammalian predation or the HM rate may have dramatic effects on the population dynamics of kea. An increase in the rate of predation had the most substantial impact of the population, with all high predation simulations quickly ending in extinction (Figure 3), with this outcome being insensitive to changes in initial population size. This result highlights the importance of ongoing predator management for the survival of kea. While a decrease in the predation level to below the current managed rate, such as may be achieved under the predator free 2050 project [@Russell2015], would see an increase in kea numbers, current management appears sufficient to maintain a stable population with a relatively low likelihood of extinction. @kemp2018 came to a similar conclusion when evaluating kea nest survival after the application of aerial sodium fluoroacetate ("Compound 1080"), showing both a decline in nest survival in areas without pest management and a substantial increase in nest survival following predator management. Furthermore, the management of mammalian predators is the most significant factor in determining the long term survival for a number of other New Zealand bird species (e.g. mohua (*Mohoua ochrocephala*) [@elliott1996], whio (*Hymenolaimus malacorhynchos*) [@simpkins2015], brown kiwi (*Apteryx mantelli*) [@Basse1999], and others see @Fea2020). Our study adds to the consensus that mammalian predator management is a fundamental factor in the conservation process for New Zealand.

While predation had the largest impact on kea population dynamics, increased HM also had a substantial effect on the kea population. At its current rate, HM had only a small negative impact on population size (and no noticeable impact on extinction risk). While any reduction in population size does decrease the resilience of the population making more susceptible to factors such as habitat loss or climate change [@Keith2008], the level of change observed under current levels of HM is likely too low to concern conservation managers. However, it is unlikely that HM will remain at its current level, if unmanaged, given the growth in the resident human population of New Zealand, tourism rates, and the correlation between human population and HWC events [@Kretser2008]. As HM rates increase over time they have an increasingly large negative effect on the kea population. Given the current low impact of HM coupled with its likely growth over time, it would be best for HM sources (e.g. vehicle collisions) to become actively managed as soon as feasible. This intervention would allow time for management practices to improve and become embedded before HM reaches a level of significant concern for the kea population. 

The model outcomes should be viewed qualitatively, as opposed to quantitatively, as there is considerable uncertainty in a some parameters [@coulson2001], although the model does appear robust to this uncertainty. First, the base HM are likely higher than were included in the model, because many HM events may not be reported or detected, although this discrepancy is difficult to quantify. Second, we did not include indirect or secondary HM events as these are difficult to assign as being human-induced events. Of particular concern is the changes in mortality rates that may occur due to kea ingesting human food, such as chocolate, which may have long-term detrimental health effects [@gartrell2007]. However, access to additional resources in times of scarcity may also decrease mortality rates during some periods, and even potentially allow for a larger sustainable population. Third, in implementing and parameterising the model (e.g. correlation of demographic parameters) we chose the most conservative approach. Therefore, it is likely that our population estimates may be slightly small; however, as we have not accounted for additional stressors, such as climate change, this overly cautious approach is likely justifiable. This uncertainty in parameter values, and thus in the precise values of the model outcomes, furthers our recommendation that management for HM be taken before it becomes a substantial threat to the population, rather than waiting for predictions of HM to become a concern.



# Acknowledgements
We thank Finnbar Lee and Andre Bellve for their help in improving the manuscript.

# Data accessibility
All the data used as well as a reproducible notebook containing the scripts to recreate this paper, including all figures, are available at https://github.com/csim063/kea_human_wildlife_conflict.

# References
